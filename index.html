<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Window Estimator AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-tap-highlight-color: transparent; font-family: sans-serif; }
        .marker { position: absolute; width: 22px; height: 22px; border: 2px solid white; border-radius: 50%; pointer-events: none; transform: translate(-50%, -50%); box-shadow: 0 2px 4px rgba(0,0,0,0.3); z-index: 10; }
        .marker-ground { background: #22c55e; } /* Green */
        .marker-second { background: #3b82f6; } /* Blue */
        .marker-third { background: #ef4444; }  /* Red */
        .input-number::-webkit-outer-spin-button, .input-number::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .btn-active { border-color: #2563eb !important; background-color: #eff6ff !important; color: #1e40af !important; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-48">

    <header class="bg-slate-900 text-white p-5 shadow-md flex justify-between items-center sticky top-0 z-50">
        <h1 class="text-xl font-bold">Window Estimator <span class="text-blue-400">AI</span></h1>
        <button onclick="resetData()" class="text-xs bg-slate-700 px-3 py-1 rounded">Reset</button>
    </header>

    <main class="p-4 max-w-md mx-auto space-y-4">

        <section class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
            <div id="canvasContainer" class="relative w-full aspect-video bg-slate-800 rounded-xl overflow-hidden mb-4 border-2 border-slate-300 flex items-center justify-center">
                <img id="mainPhoto" class="w-full h-full object-contain hidden" onclick="placeMarker(event)">
                <p id="placeholderText" class="text-slate-400 text-sm text-center">Upload or Capture a House Photo</p>
            </div>

            <div class="space-y-3 mb-4">
                <div>
                    <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Step 1: Select Size</p>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setMode('size', 'small')" id="sz-small" class="size-btn py-2 rounded-lg border-2 border-transparent bg-slate-100 text-slate-600 font-bold text-xs btn-active">Small</button>
                        <button onclick="setMode('size', 'medium')" id="sz-medium" class="size-btn py-2 rounded-lg border-2 border-transparent bg-slate-100 text-slate-600 font-bold text-xs">Medium</button>
                        <button onclick="setMode('size', 'large')" id="sz-large" class="size-btn py-2 rounded-lg border-2 border-transparent bg-slate-100 text-slate-600 font-bold text-xs">Large</button>
                    </div>
                </div>
                <div>
                    <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Step 2: Select Height</p>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setMode('height', 'ground')" id="ht-ground" class="ht-btn py-2 rounded-lg border-2 border-transparent bg-slate-100 text-slate-600 font-bold text-xs btn-active">Ground</button>
                        <button onclick="setMode('height', 'second')" id="ht-second" class="ht-btn py-2 rounded-lg border-2 border-transparent bg-slate-100 text-slate-600 font-bold text-xs">2nd Story</button>
                        <button onclick="setMode('height', 'third')" id="ht-third" class="ht-btn py-2 rounded-lg border-2 border-transparent bg-slate-100 text-slate-600 font-bold text-xs">3rd Story</button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-2">
                <input type="file" accept="image/*" capture="environment" id="cameraInput" class="hidden" onchange="handleFile(this)">
                <input type="file" accept="image/*" id="uploadInput" class="hidden" onchange="handleFile(this)">
                <button onclick="document.getElementById('cameraInput').click()" class="bg-blue-600 text-white py-3 rounded-xl font-bold text-sm">üì∏ Camera</button>
                <button onclick="document.getElementById('uploadInput').click()" class="bg-slate-800 text-white py-3 rounded-xl font-bold text-sm">üìÅ Upload</button>
            </div>
        </section>

        <section class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-bold text-slate-800">Review Counts</h2>
                <label class="flex items-center gap-2 text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded">
                    <input type="checkbox" id="taxToggle" onchange="calculate()"> +8.25% TAX
                </label>
            </div>
            <div id="countGrid" class="space-y-3"></div>
        </section>
    </main>

    <section class="fixed bottom-4 left-4 right-4 max-w-md mx-auto bg-slate-900 text-white p-5 rounded-2xl shadow-2xl z-50">
        <div class="flex justify-between items-center mb-4">
            <div>
                <p class="text-slate-400 text-[10px] font-bold uppercase tracking-wider">Total Quote</p>
                <p class="text-3xl font-black text-blue-400" id="totalPrice">$0.00</p>
            </div>
            <div class="text-right">
                <p class="text-slate-400 text-[10px] font-bold uppercase tracking-wider">Windows</p>
                <p class="text-xl font-bold" id="totalCount">0</p>
            </div>
        </div>
        <button onclick="downloadSummary()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-900/20">üíæ Download Estimate</button>
    </section>

    <script>
        const BASE_RATES = { small: 5, medium: 10, large: 15 };
        const MULTIPLIERS = { ground: 1.0, second: 1.3, third: 1.6 };
        let selSize = 'small';
        let selHeight = 'ground';
        
        let counts = JSON.parse(localStorage.getItem('windowCounts')) || {
            small: { ground: 0, second: 0, third: 0 },
            medium: { ground: 0, second: 0, third: 0 },
            large: { ground: 0, second: 0, third: 0 }
        };

        function setMode(type, val) {
            if(type === 'size') {
                selSize = val;
                document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('btn-active'));
                document.getElementById(`sz-${val}`).classList.add('btn-active');
            } else {
                selHeight = val;
                document.querySelectorAll('.ht-btn').forEach(b => b.classList.remove('btn-active'));
                document.getElementById(`ht-${val}`).classList.add('btn-active');
            }
        }

        function initGrid() {
            const grid = document.getElementById('countGrid');
            grid.innerHTML = '<div class="grid grid-cols-4 gap-2 text-[9px] font-bold text-slate-400 uppercase text-center mb-1"><div>Size</div><div>Gnd</div><div>2nd</div><div>3rd</div></div>';
            ['small', 'medium', 'large'].forEach(s => {
                const row = document.createElement('div');
                row.className = "grid grid-cols-4 gap-2 items-center";
                row.innerHTML = `<div class="font-bold text-slate-700 text-xs capitalize">${s}</div>` + 
                    ['ground', 'second', 'third'].map(h => `
                        <input type="number" value="${counts[s][h]}" oninput="updateCount('${s}', '${h}', this.value)" id="in-${s}-${h}"
                        class="w-full p-2 bg-slate-50 border border-slate-200 rounded text-center font-bold text-sm">
                    `).join('');
                grid.appendChild(row);
            });
            calculate();
        }

        function updateCount(s, h, v) {
            counts[s][h] = parseInt(v) || 0;
            localStorage.setItem('windowCounts', JSON.stringify(counts));
            calculate();
        }

        function calculate() {
            let sub = 0, qty = 0;
            for(let s in counts) for(let h in counts[s]) {
                sub += counts[s][h] * (BASE_RATES[s] * MULTIPLIERS[h]);
                qty += counts[s][h];
            }
            if(document.getElementById('taxToggle').checked) sub *= 1.0825;
            document.getElementById('totalPrice').innerText = `$${sub.toFixed(2)}`;
            document.getElementById('totalCount').innerText = qty;
        }

        function placeMarker(e) {
            const rect = e.target.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 100;
            const y = ((e.clientY - rect.top) / rect.height) * 100;
            const marker = document.createElement('div');
            marker.className = `marker marker-${selHeight}`;
            marker.style.left = `${x}%`; marker.style.top = `${y}%`;
            document.getElementById('canvasContainer').appendChild(marker);
            
            counts[selSize][selHeight]++;
            document.getElementById(`in-${selSize}-${selHeight}`).value = counts[selSize][selHeight];
            updateCount(selSize, selHeight, counts[selSize][selHeight]);
        }

        function handleFile(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.getElementById('mainPhoto');
                    img.src = e.target.result;
                    img.classList.remove('hidden');
                    document.getElementById('placeholderText').classList.add('hidden');
                    document.querySelectorAll('.marker').forEach(m => m.remove());
                };
                reader.readAsDataURL(file);
            }
        }

        function downloadSummary() {
            const total = document.getElementById('totalPrice').innerText;
            const text = `ESTIMATE SUMMARY\nTotal Windows: ${document.getElementById('totalCount').innerText}\nTotal Price: ${total}`;
            const blob = new Blob([text], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'WindowEstimate.txt';
            a.click();
        }

        function resetData() { if(confirm("Clear everything?")) { localStorage.clear(); location.reload(); } }
        initGrid();
    </script>
</body>
</html>
