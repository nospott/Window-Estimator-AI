<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Window Estimator AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        .input-number { -moz-appearance: textfield; }
        .input-number::-webkit-outer-spin-button, .input-number::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-20">

    <header class="bg-slate-900 text-white p-5 shadow-md sticky top-0 z-50 flex justify-between items-center">
        <h1 class="text-xl font-bold tracking-tight">Window Estimator <span class="text-blue-400">AI</span></h1>
        <button onclick="resetData()" class="text-xs bg-slate-700 px-3 py-1 rounded">Reset</button>
    </header>

    <main class="p-4 max-w-md mx-auto space-y-6">

        <section class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
            <h2 class="font-bold text-slate-800 mb-3 flex items-center gap-2">ðŸ“¸ Site Photos</h2>
            <input type="file" accept="image/*" capture="environment" id="cameraInput" class="hidden">
            <div class="flex flex-col gap-3">
                <button onclick="document.getElementById('cameraInput').click()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold shadow-blue-200 shadow-lg active:scale-95 transition-transform">
                    Capture New Window
                </button>
                <div id="photoPreview" class="flex gap-2 overflow-x-auto pb-2"></div>
            </div>
        </section>

        <section class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
            <h2 class="font-bold text-slate-800 mb-4">Window Counts</h2>
            <div class="grid grid-cols-4 gap-2 mb-2 text-xs font-bold text-slate-400 uppercase tracking-wider text-center">
                <div>Size</div><div>Gnd</div><div>2nd</div><div>3rd</div>
            </div>
            <div id="countGrid" class="space-y-4">
                </div>
        </section>

        <section class="fixed bottom-4 left-4 right-4 max-w-md mx-auto bg-slate-900 text-white p-5 rounded-2xl shadow-2xl border border-slate-700">
            <div class="flex justify-between items-center mb-3">
                <div>
                    <p class="text-slate-400 text-xs uppercase font-bold">Total Estimate</p>
                    <p class="text-3xl font-black text-blue-400" id="totalPrice">$0.00</p>
                </div>
                <div class="text-right">
                    <p class="text-slate-400 text-xs uppercase font-bold">Count</p>
                    <p class="text-xl font-bold" id="totalCount">0</p>
                </div>
            </div>
            <button onclick="shareEstimate()" class="w-full bg-white text-slate-900 py-3 rounded-lg font-bold flex justify-center items-center gap-2">
                ðŸ“¤ Share Summary
            </button>
        </section>

    </main>

    <script>
        // --- CONFIGURATION ---
        const BASE_RATES = { small: 5.00, medium: 10.00, large: 15.00 };
        const MULTIPLIERS = { ground: 1.0, second: 1.3, third: 1.6 };
        
        const sizes = ['small', 'medium', 'large'];
        const heights = ['ground', 'second', 'third'];
        
        // Load initial state from LocalStorage or defaults
        let counts = JSON.parse(localStorage.getItem('windowCounts')) || {
            small: { ground: 0, second: 0, third: 0 },
            medium: { ground: 0, second: 0, third: 0 },
            large: { ground: 0, second: 0, third: 0 }
        };

        // Build UI
        function initGrid() {
            const grid = document.getElementById('countGrid');
            grid.innerHTML = '';
            sizes.forEach(size => {
                const row = document.createElement('div');
                row.className = "grid grid-cols-4 gap-2 items-center";
                row.innerHTML = `
                    <div class="capitalize font-bold text-slate-700">${size}</div>
                    ${heights.map(h => `
                        <input type="number" value="${counts[size][h]}" 
                            oninput="updateCount('${size}', '${h}', this.value)"
                            class="input-number w-full p-3 bg-slate-100 border-none rounded-lg text-center font-bold text-slate-800 focus:ring-2 focus:ring-blue-500">
                    `).join('')}
                `;
                grid.appendChild(row);
            });
            calculate();
        }

        function updateCount(size, height, val) {
            counts[size][height] = parseInt(val) || 0;
            localStorage.setItem('windowCounts', JSON.stringify(counts));
            calculate();
        }

        function calculate() {
            let total = 0;
            let qty = 0;
            sizes.forEach(s => {
                heights.forEach(h => {
                    total += counts[s][h] * (BASE_RATES[s] * MULTIPLIERS[h]);
                    qty += counts[s][h];
                });
            });
            document.getElementById('totalPrice').innerText = `$${total.toFixed(2)}`;
            document.getElementById('totalCount').innerText = qty;
        }

        function resetData() {
            if(confirm("Clear all counts?")) {
                localStorage.clear();
                location.reload();
            }
        }

        function shareEstimate() {
            const total = document.getElementById('totalPrice').innerText;
            const text = `Window Cleaning Estimate\nTotal Windows: ${document.getElementById('totalCount').innerText}\nEstimated Total: ${total}`;
            if (navigator.share) {
                navigator.share({ title: 'Window Estimate', text: text });
            } else {
                alert(text);
            }
        }

        // Photo Handling
        document.getElementById('cameraInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.className = "h-20 w-20 object-cover rounded-xl border-2 border-white shadow-md
